# JSON Tag Test App for Android

This is a Test App to showcase how [JSON Tag](https://github.com/floriangoetting/json-tag) can be used with a native Android App to send data to a server-side Google Tag Manager Instance which is running [JSON Client](https://github.com/floriangoetting/json-client).

The JSON Client receives JSON Payloads and makes the data available in the Event Data. The built-in ID Service creates long lasting server-side set (HTTP-Only) cookies for visitor identification.

For a detailed guide please check the [Blogpost about JSON Tag & JSON Client](https://www.floriangoetting.de/en/json-tag-json-client-a-flexible-first-party-tracking-solution-for-ssgtm/?utm_source=github&utm_medium=social&utm_campaign=ssgtm-json-tag-json-client-first-party-tracking&utm_content=json-client-repo).

## How to install the Test App
1. Download and Install Android Studio: https://developer.android.com/studio
2. Download and Install Git: https://git-scm.com/downloads
3. Clone the Project from Git in Android Studio under File -> New -> Project from Version Control by entering the repository url (https://github.com/floriangoetting/json-tag-test-app-android) and clicking on "clone"
4. Update the sample tracker config from line 128 in the MainActivity.kt file (app/src/main/java/com/floriangoetting/jsontagtestapp/MainActivity.kt) to configure your sstEndpoint, webview URL, cookie names and more
5. Run the App using a real Android device which is connected to your computer or by running it on an emulated device by clicking the green play button on the top menu

## How to debug the Native App Tracking Requests
To debug the tracking calls generated by the Test App, the easiest way is to set the GTM Server Preview Header in the tracker configuration. This enables you to see the native App tracking calls in the ssGTM Preview Mode.

### Debug Native App Requests using the configuration Option and ssGTM Preview Mode
To enable the ssGTM Preview Mode, follow these steps:
1. Start the preview mode in your ssGTM Instance
2. Click the three dots menu on the top right and select "Send requests manually"
3. Copy the X-Gtm-Server-Preview HTTP header value
4. Go to the tracker configuration in Android Studio in the MainActivity.kt file (app/src/main/java/com/floriangoetting/jsontagtestapp/MainActivity.kt), uncomment the "tracker.setGtmServerPreviewHeader" option and update the gtm server preview header value with the one you copied in step 3
5. Run the App again to trigger a new Build and check the ssGTM Preview Mode to see the tracking requests

### Debug Webview App Requests using Charles Proxy and ssGTM Preview Mode
Unfortunately this method only works for the native Tracking calls but not for Tracking Calls which are happening in the App Webviews. If you want to see the App Webview Tracking calls in the ssGTM preview mode as well, an option would be to use a Network Proxy like the charles proxy to add the X-Gtm-Server-Preview HTTP header dynamically to the tracking calls. If this method is used, it is not required to use the tracker configuration for the server preview header.

To enable the dynamic addition of the X-Gtm-Server-Preview HTTP header in Charles proxy follow these steps:
1. Install and configure Charles proxy to proxy the requests from your test device: https://www.charlesproxy.com/download/latest-release/
2. Add a new rewrite Rule in Charles Proxy under Tools -> Rewrite -> Add
3. Add a new location with the host and path of your tracking calls which are sent to your server side GTM Instance
4. Add a rule action and select "Add header" as type
5. Leave the match section empty and under replace set "X-Gtm-Server-Preview" as Name and your X-Gtm-Server-Preview HTTP header value (copied from the ssGTM Preview Mode) as the value
6. Save the rule and make sure that rewrites are enabled
7. Trigger tracking calls again and check the ssGTM Preview Mode to see the tracking requests
